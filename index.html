<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vital ðŸ’Œ</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box;}
  body{
    font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
    background:#0f0f0f;
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
    min-height:100vh;
    padding:20px;
  }
  h1{ color:#a64ca6; margin-top:40px; font-size:2rem; text-align:center; }
  textarea{
    width:90%; max-width:400px; height:100px; padding:15px; border-radius:20px;
    border:2px solid #a64ca6; background:#1a1a1a; color:#fff; font-size:16px;
    margin-top:20px; outline:none; transition:all 0.3s ease;
  }
  textarea:focus{ border-color:#fff; }
  button{
    margin-top:15px; padding:12px 30px; font-size:16px; border:none; border-radius:25px;
    background:#a64ca6; color:#fff; cursor:pointer; transition:opacity 0.3s, transform 0.2s;
  }
  button:hover{ opacity:0.8; transform:scale(1.05);}
  #mensagensContainer{
    margin-top:30px; width:90%; max-width:400px; display:flex; flex-direction:column; gap:12px;
  }
  .mensagem{
    background:#1a1a1a; padding:12px 15px; border-radius:15px;
    border-left:4px solid #a64ca6; font-size:15px; word-wrap:break-word;
    box-shadow:0 4px 8px rgba(0,0,0,0.3); opacity:0; transform:translateY(-20px);
    animation: abrirEnvelope 0.5s forwards;
  }
  @keyframes abrirEnvelope{
    to{ opacity:1; transform:translateY(0);}
  }
</style>
</head>
<body>

<h1>Vital</h1>
<textarea id="mensagemInput" placeholder="Escreva sua mensagem..."></textarea>
<button onclick="enviarMensagem()">Enviar</button>

<div id="mensagensContainer"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
  // ===== PWA Manifest Inline =====
  const manifestJSON = {
    "name": "Vital",
    "short_name": "Vital",
    "start_url": "./",
    "display": "standalone",
    "background_color": "#0f0f0f",
    "theme_color": "#a64ca6",
    "icons":[{"src":"https://i.imgur.com/7z1i4Hw.png","sizes":"192x192","type":"image/png"}]
  };
  const manifest = document.createElement('link');
  manifest.rel='manifest';
  manifest.href=URL.createObjectURL(new Blob([JSON.stringify(manifestJSON)],{type:'application/json'}));
  document.head.appendChild(manifest);

  // ===== Service Worker Inline (offline) =====
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register(URL.createObjectURL(new Blob([`
      const CACHE_NAME='vital-cache-v1';
      const urlsToCache=['./'];
      self.addEventListener('install', e=>{ e.waitUntil(caches.open(CACHE_NAME).then(c=>c.addAll(urlsToCache))); });
      self.addEventListener('fetch', e=>{ e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request))); });
    `],{type:'text/javascript'}))).then(()=>console.log('SW Vital registrado!'));
  }

  // ===== Firebase Config â€“ Substitua pelos dados reais do seu projeto =====
  const firebaseConfig = {
  apiKey: "AIzaSyCdvG19MnplrrKlfZdsx6VFIsdLkTHbP3o",
  authDomain: "vital-e22d5.firebaseapp.com",
  databaseURL: "https://vital-e22d5-default-rtdb.firebaseio.com",
  projectId: "vital-e22d5",
  storageBucket: "vital-e22d5.firebasestorage.app",
  messagingSenderId: "76460889955",
  appId: "1:76460889955:web:8e82a93e29357d1a6ce556"
};

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const mensagensContainer = document.getElementById('mensagensContainer');

  // Ativar persistÃªncia offline do Firebase
  firebase.database().ref().keepSynced(true);

  // ===== PermissÃ£o NotificaÃ§Ã£o =====
  if('Notification' in window){ Notification.requestPermission(); }

  // ===== Mensagens pendentes offline =====
  let filaOffline = [];

  // Enviar mensagem
  function enviarMensagem(){
    const input = document.getElementById('mensagemInput');
    const texto = input.value.trim();
    if(!texto) return;
    const timestamp = Date.now();
    const msg = {texto, timestamp};

    if(navigator.onLine){
      db.ref('mensagens').push(msg);
    } else {
      filaOffline.push(msg);
      mostrarMensagem(texto);
    }
    input.value='';
  }

  // Enviar mensagens pendentes quando voltar online
  window.addEventListener('online', ()=>{
    filaOffline.forEach(msg=> db.ref('mensagens').push(msg));
    filaOffline=[];
  });

  // Receber mensagens do Firebase
  db.ref('mensagens').on('child_added', snapshot=>{
    const msg = snapshot.val();
    const agora = Date.now();
    if(msg.timestamp>agora){
      setTimeout(()=>{ mostrarMensagem(msg.texto); }, msg.timestamp-agora);
    } else { mostrarMensagem(msg.texto); }
  });

  function mostrarMensagem(texto){
    const div = document.createElement('div');
    div.className='mensagem';
    div.textContent=texto;
    mensagensContainer.appendChild(div);
    div.scrollIntoView({behavior:'smooth'});

    if(Notification.permission==='granted'){
      new Notification('Nova mensagem ðŸ’œ',{body:texto});
    }
  }
</script>

</body>
</html>